 <div class="page-actions">
    <button class="btn btn-primary" onclick="showCategoryForm()">
        <i class="fas fa-plus"></i> Nueva Categoría
    </button>
    </div>

    <!-- Form Modal -->
    <div class="modal" id="categoryModal">
        <div class="modal-content">
            <h3 id="categoryModalTitle">Nueva Categoría</h3>
            <form id="categoryForm" onsubmit="handleCategorySubmit(event)">
                <input type="hidden" id="categoryId">
                <div class="form-group">
                    <label for="catName">Nombre *</label>
                    <input type="text" id="catName" required placeholder="Nombre de la categoría">
                </div>
                <div class="form-group">
                    <label for="catDescription">Descripción</label>
                    <textarea id="catDescription" rows="3" placeholder="Descripción opcional..."></textarea>
                </div>
                <div class="modal-actions">
                    <button type="button" class="btn btn-secondary" onclick="closeModal()">Cancelar</button>
                    <button type="submit" class="btn btn-primary" id="catSubmitBtn">Guardar</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Delete Modal -->
    <div class="modal" id="deleteCatModal">
        <div class="modal-content">
            <h3><i class="fas fa-exclamation-triangle"></i> Confirmar Eliminación</h3>
            <p>¿Está seguro que desea eliminar esta categoría?</p>
            <div class="modal-actions">
                <button class="btn btn-secondary" onclick="closeCatDeleteModal()">Cancelar</button>
                <button class="btn btn-danger" id="confirmCatDeleteBtn">Eliminar</button>
            </div>
        </div>
    </div>

    <div class="panel">
        <div class="panel-body">
            <table class="data-table">
                <thead>
                    <tr>
                        <th>Nombre</th>
                        <th>Slug</th>
                        <th>Descripción</th>
                        <th>Estado</th>
                        <th>Acciones</th>
                    </tr>
                </thead>
                <tbody id="categoriesBody">
                    <tr>
                        <td colspan="5" class="text-center">Cargando...</td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', loadCategories);

        async function loadCategories() {
            try {
                const data = await apiGet('/api/categories?all=true');
                if (data.success) {
                    const tbody = document.getElementById('categoriesBody');
                    if (data.data.categories.length === 0) {
                        tbody.innerHTML = '<tr><td colspan="5" class="text-center">No hay categorías</td></tr>';
                        return;
                    }
                    tbody.innerHTML = data.data.categories.map(c => `
          <tr>
            <td><strong>${c.name}</strong></td>
            <td>${c.slug}</td>
            <td>${c.description || '-'}</td>
            <td><span class="badge badge-${c.active ? 'success' : 'warning'}">${c.active ? 'Activa' : 'Inactiva'}</span></td>
            <td>
              <div class="action-buttons">
                <button class="btn btn-sm btn-info" onclick="editCategory('${c._id}', '${c.name}', '${c.description || ''}')">
                  <i class="fas fa-edit"></i>
                </button>
                <button class="btn btn-sm btn-danger" onclick="confirmDeleteCategory('${c._id}')">
                  <i class="fas fa-trash"></i>
                </button>
              </div>
            </td>
          </tr>
        `).join('');
      }
    } catch (err) {
      console.error(err);
    }
  }

  function showCategoryForm() {
    document.getElementById('categoryModalTitle').textContent = 'Nueva Categoría';
    document.getElementById('categoryId').value = '';
    document.getElementById('catName').value = '';
    document.getElementById('catDescription').value = '';
    document.getElementById('categoryModal').classList.add('show');
  }

  function editCategory(id, name, desc) {
    document.getElementById('categoryModalTitle').textContent = 'Editar Categoría';
    document.getElementById('categoryId').value = id;
    document.getElementById('catName').value = name;
    document.getElementById('catDescription').value = desc;
    document.getElementById('categoryModal').classList.add('show');
  }

  function closeModal() {
    document.getElementById('categoryModal').classList.remove('show');
  }

  async function handleCategorySubmit(e) {
    e.preventDefault();
    const id = document.getElementById('categoryId').value;
    const body = {
      name: document.getElementById('catName').value,
      description: document.getElementById('catDescription').value,
    };

    try {
      const url = id ? `/api/categories/${id}` : '/api/categories';
      const method = id ? 'PUT' : 'POST';
      const data = await apiFetch(url, { method, body: JSON.stringify(body) });
      if (data.success) {
        showToast(data.message, 'success');
        closeModal();
        loadCategories();
      } else {
        showToast(data.message, 'error');
      }
    } catch (err) {
      showToast('Error al guardar categoría', 'error');
    }
  }

  let deleteCatId = null;
  function confirmDeleteCategory(id) {
    deleteCatId = id;
    document.getElementById('deleteCatModal').classList.add('show');
    document.getElementById('confirmCatDeleteBtn').onclick = async () => {
      try {
        const data = await apiFetch(`/api/categories/${deleteCatId}`, { method: 'DELETE' });
        if (data.success) {
          showToast(data.message, 'success');
          loadCategories();
        }
      } catch (err) {
        showToast('Error al eliminar', 'error');
      }
      closeCatDeleteModal();
    };
  }

  function closeCatDeleteModal() {
    document.getElementById('deleteCatModal').classList.remove('show');
    deleteCatId = null;
  }
    </script>
    