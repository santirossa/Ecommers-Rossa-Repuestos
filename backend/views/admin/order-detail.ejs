 <div class="page-actions">
    <a href="/admin/orders" class="btn btn-secondary">
        <i class="fas fa-arrow-left"></i> Volver a Pedidos
    </a>
    </div>

    <div class="order-detail-grid">
        <div class="panel">
            <div class="panel-header">
                <h2><i class="fas fa-shopping-cart"></i> Pedido #<span
                        id="orderId">${orderId.slice(-6).toUpperCase()}</span></h2>
            </div>
            <div class="panel-body" id="orderInfo">
                <p>Cargando...</p>
            </div>
        </div>

        <div class="panel">
            <div class="panel-header">
                <h2><i class="fas fa-exchange-alt"></i> Cambiar Estado</h2>
            </div>
            <div class="panel-body">
                <select id="statusSelect" class="full-width">
                    <option value="pendiente">Pendiente</option>
                    <option value="pagado">Pagado</option>
                    <option value="preparando">Preparando</option>
                    <option value="enviado">Enviado</option>
                    <option value="entregado">Entregado</option>
                    <option value="cancelado">Cancelado</option>
                </select>
                <button class="btn btn-primary" style="margin-top:1rem; width:100%;" onclick="updateStatus()">
                    <i class="fas fa-save"></i> Actualizar Estado
                </button>
            </div>
        </div>
    </div>

    <div class="panel">
        <div class="panel-header">
            <h2><i class="fas fa-list"></i> Items del Pedido</h2>
        </div>
        <div class="panel-body">
            <table class="data-table">
                <thead>
                    <tr>
                        <th>Imagen</th>
                        <th>Producto</th>
                        <th>Precio Unit.</th>
                        <th>Cantidad</th>
                        <th>Subtotal</th>
                    </tr>
                </thead>
                <tbody id="orderItems">
                    <tr>
                        <td colspan="5" class="text-center">Cargando...</td>
                    </tr>
                </tbody>
                <tfoot>
                    <tr>
                        <td colspan="4" style="text-align:right"><strong>Total:</strong></td>
                        <td><strong id="orderTotal">-</strong></td>
                    </tr>
                </tfoot>
            </table>
        </div>
    </div>

    <script>
        const orderId = '${orderId}';

        document.addEventListener('DOMContentLoaded', loadOrder);

        async function loadOrder() {
            try {
                const data = await apiGet(`/api/orders/${orderId}`);
      if (data.success) {
        const o = data.data.order;

        // Info del pedido
        document.getElementById('orderInfo').innerHTML = `
          <div class="info-grid">
            <div><strong>Cliente:</strong> ${o.user?.name || 'N/A'}</div>
            <div><strong>Email:</strong> ${o.user?.email || 'N/A'}</div>
            <div><strong>Teléfono:</strong> ${o.user?.phone || 'N/A'}</div>
            <div><strong>Fecha:</strong> ${new Date(o.createdAt).toLocaleString('es-AR')}</div>
            <div><strong>Estado:</strong> <span class="badge badge-${o.status}">${o.status}</span></div>
            <div><strong>Pago:</strong> ${o.paymentStatus || 'Sin pago'}</div>
            <div><strong>ID Pago MP:</strong> ${o.paymentId || '-'}</div>
            <div><strong>Dirección:</strong> ${o.shippingAddress?.street || ''}, ${o.shippingAddress?.city || ''}, ${o.shippingAddress?.province || ''}</div>
            ${o.notes ? '<div><strong>Notas:</strong> ' + o.notes + '</div>' : ''}
          </div>
        `;

        // Status select
        document.getElementById('statusSelect').value = o.status;

        // Items
        document.getElementById('orderItems').innerHTML = o.items.map(item => `
          <tr>
            <td><img src="${item.image || '/admin/assets/img/no-image.png'}" alt="${item.name}" class="product-thumb" onerror="this.src='/admin/assets/img/no-image.png'"></td>
            <td>${item.name}</td>
            <td>$${Number(item.price).toLocaleString('es-AR')}</td>
            <td>${item.quantity}</td>
            <td>$${Number(item.price * item.quantity).toLocaleString('es-AR')}</td>
          </tr>
        `).join('');

        document.getElementById('orderTotal').textContent = '$' + Number(o.total).toLocaleString('es-AR');
      }
    } catch (err) {
      showToast('Error al cargar pedido', 'error');
    }
  }

  async function updateStatus() {
    const status = document.getElementById('statusSelect').value;
    try {
      const data = await apiFetch(`/api/orders/${orderId}/status`, {
        method: 'PUT',
        body: JSON.stringify({ status }),
      });
      if (data.success) {
        showToast(data.message, 'success');
        loadOrder();
      } else {
        showToast(data.message, 'error');
      }
    } catch (err) {
      showToast('Error al actualizar estado', 'error');
    }
  }
    </script>
    